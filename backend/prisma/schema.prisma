// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// Enum para os perfis de usuário
enum Role {
  PMM       // Profissional de Manutenção e Melhoria
  LIDER     // Líderes de equipe
  PMS       // Profissional de Manutenção de Sistemas
  TECNICO   // Técnicos
  ESTAGIARIO // Estagiários
}

// Enum para o status das metas
enum Status {
  PENDENTE
  EM_ANDAMENTO
  CONCLUIDA
  DELETE
}

// --- NOVOS MODELOS E RELAÇÕES ---
model ProductionLine {
  id    String @id @default(cuid())
  name  String @unique // Ex: "TRIM 1", "CHASSIS 4"
  users User[]   // Relação com os usuários
}

model User {
  id                  String           @id @default(cuid())
  email               String           @unique
  name                String
  password            String
  role                Role             @default(TECNICO)
  createdAt           DateTime         @default(now())
  updatedAt           DateTime         @updatedAt
  
  // Campos de Perfil
  technicalSkills     String?
  certifications      String?
  avatarUrl           String?
  
  // Relações
  productionLines     ProductionLine[]
  evaluations         Evaluation[]
  selfAssessments     SelfAssessment[]
  receivedFeedbacks   Feedback[]       @relation("RecipientFeedbacks")
  authoredFeedbacks   Feedback[]       @relation("AuthorFeedbacks")
  goals               Goal[]           @relation("UserGoals")
  authoredGoals       Goal[]           @relation("AuthorGoals")
}

model Evaluation {
  id                             String   @id @default(cuid())
  createdAt                      DateTime @default(now())
  updatedAt                      DateTime @updatedAt
  
  user   User   @relation(fields: [userId], references: [id])
  userId String

  // --- CAMPOS DA NOVA AVALIAÇÃO (VALOR BRUTO + PONTUAÇÃO CALCULADA) ---

  // PROJETOS
  quick_value                    Int? // Valor inserido pelo líder
  quick_score                    Int? // Nota 1-5 calculada
  standard_value                 Int?
  standard_score                 Int?

  // Notas
  qtdGeralManutencao_value       Int?
  qtdGeralManutencao_score       Int?

  // QUEBRA DE MÁQUINA
  quebraMaior30minTurno_value    Int?
  quebraMaior30minTurno_score    Int?
  mttrTurno_value                Float? // Usando Float para minutos
  mttrTurno_score                Int?

  // ANÁLISE DE QUEBRA
  qualidadeExecucaoEWO_value     Float? // Usando Float para percentual
  qualidadeExecucaoEWO_score     Int?
  tempoAberturaEWO_value         Int?
  tempoAberturaEWO_score         Int?

  // EFICIÊNCIA MONTAGEM
  opeGeral_value                 Float?
  opeGeral_score                 Int?
  nonOpeBreak_value              Float?
  nonOpeBreak_score              Int?

  // ASSIDUIDADE
  absenteismo_value              Int?
  absenteismo_score              Int?
  saturacaoTrabalho_value        Float?
  saturacaoTrabalho_score        Int?

  // SEGURANÇA
  sugestoesSeguranca_value       Int?
  sugestoesSeguranca_score       Int?
  cartoesRecebidos_value         Int?
  cartoesRecebidos_score         Int?
  zeroAcidenteTurno_value        Int?
  zeroAcidenteTurno_score        Int?
  condicoesAbertasArea_value     Int?
  condicoesAbertasArea_score     Int?

  // ENTREGA
  atendimentoUTE_value           Int?
  atendimentoUTE_score           Int?
  avaliacaoTecnica_value         Int? // Este pode ser direto 1-5
  avaliacaoTecnica_score         Int?
  backlogManutencao_value        Int?
  backlogManutencao_score        Int?
  avaliacaoComportamental_value  Int? // Este pode ser direto 1-5
  avaliacaoComportamental_score  Int?
  qualidadeLancamentosSAP_value  Float?
  qualidadeLancamentosSAP_score  Int?
  
  // NOTA FINAL PONDERADA
  finalScore                     Float?
}

model SelfAssessment {
  id                  String   @id @default(cuid())
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  
  user   User   @relation(fields: [userId], references: [id])
  userId String

  strengths           String
  improvementPoints   String
  professionalGoals   String
}

model Feedback {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())
  content     String

  recipient   User   @relation("RecipientFeedbacks", fields: [recipientId], references: [id])
  recipientId String

  author   User   @relation("AuthorFeedbacks", fields: [authorId], references: [id])
  authorId String
}

model Goal {
  id          String    @id @default(cuid())
  createdAt   DateTime  @default(now())
  title       String
  description String?
  dueDate     DateTime?
  status      Status    @default(PENDENTE)
  
  user   User   @relation("UserGoals", fields: [userId], references: [id])
  userId String

  author   User   @relation("AuthorGoals", fields: [authorId], references: [id])
  authorId String
}

model DailyOeeResult {
  id            String   @id @default(cuid())
  date          DateTime
  lineDesc      String
  shift         Int
  
  availability  Float?
  performance   Float
  quality       Float?
  oee           Float

  @@unique([date, lineDesc, shift])
}

model StagingOeeResult {
  id            String   @id @default(cuid())
  date          DateTime
  lineDesc      String
  shift         Int
  availability  Float?
  performance   Float
  quality       Float?
  oee           Float

  @@unique([date, lineDesc, shift])
}